#!/usr/bin/env bash

# shellcheck disable=SC2154
exec > >(tee /var/log/user-data.log | logger --tag user-data --stderr 2>/dev/console) 2>&1

echo ECS_CLUSTER="${cluster_name}" >> /etc/ecs/ecs.config

sysctl -w vm.max_map_count=262144
sysctl -w fs.file-max=65536

# shellcheck disable=SC2034
ES_HOME="${elasticsearch_home}"

mkdir -p "$${ES_HOME}/data"
mkdir -p "$${ES_HOME}/logs"
mkdir -p "$${ES_HOME}/plugins"
mkdir -p "$${ES_HOME}/tmp"

chown -R 1000:1000 "$${ES_HOME}"/*
